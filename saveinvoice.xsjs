//const input={"invoiceItems":[{"invoiceID":"60961-ROC","invoiceItemIndex":1,"invoiceStatus":"In_Progress","documentType":"","documentDate":"2019-5-13","invoiceDate":"2019-5-16","postingDate":"","invoicingParty":"","companyCode":"","paymentCurrency":"USD","invoiceType":"","headerText":"","supplierNumber":"","paymentMethod":"","paymentBlock":"","partnerBank":"","houseBank":"","houseBankAccountID":"","paymentMethodSupp":"","autoCalculateTaxIndicator":"","totalTaxAmount":"","taxJurisdiction":"","baselineDate":"","dueDate":"","vatAmount":"","vatAmount1":"","vatAmount2":"","vatAmount3":"","vatAmount4":"","vatRate":"","vatRate1":"","vatRate2":"","vatRate3":"","vatRate4":"","paymentTerms":"Net due in 30 days","day1":"","day2":"","day3":"","discount1":"","discount2":"","exchangeRate":"","withholdingTax":"","unplannedDeliveryCost":"","instanceKey":"","bankAccount":"","bankName":"","bankNumber":"","bankPartnerType":"","vatID":"","vatID1":"","vatID2":"","vatID3":"","vatID4":"","requestorEmail":"","invoiceFreightAmount":"","invoiceHandlingCharges":"","alternatePayee":"","documentItemInInvoice":"","purchaseOrder":"4500280896","itemPurchaseOrder":"","uomPurchaseOrder":"","amountDocumentCurrency":"","deliveryNoteNumber":"","materialNumber":"","taxCode":"","accountAssigned":"","directPostingGL":"","directPostingMaterial":"","lastUser":"","currentUser":"","lastUpdatedTS":"","lastRole":"","invoiceCategory":"","shipToAddress1":"Plant 1","shipToAddress2":"3475 Deer Creek","billToCompany":"TCL USA","billToName":"","billToPhone":"","billToAddress1":"Head Office","billToAddress2":"3475 Deer Creek","billToCountry":"USA","billToVAT":"","billToEmail":"","remitName":"KMM Corporation","remitToAddress1":"Shanghai","remitToAddress2":"CHINA 12345","remitToPin":"","remitToStreet":"Street 123","remitToVAT":"","remitToEmail":"","remitToPhone":"","supplierName":"","supplierName2":"","supplierPOBox":"","supplierPOBoxZip":"","supplierStreet":"","supplierState":"","supplierZip":"","netAmount":"","ibanNumber":"","swiftCode":"","grossAmount":"1010","glAccount":"","glDescription":"","costCenter":"","costCenterDescription":"","wbsElement":"","wbsElementDescription":"","internalOrder":"","internalOrderDescription":"","assetID":"","assetDescription":"","invoiceFileName":"https://s3.amazonaws.com/subscriptionbasedintelligent-app/invoice_1558007696198.jpg","postedInvoice":"","invoiceGUID":"0ef7906b-6b01-4680-8a61-113d4bfb20e0","itemNumber":"","itemCode":"1033021-002","itemDescription":"Office Supplies","itemQuantity":"100.00","unitPrice":"10.00","itemUnit":"","itemQuantityShipped":"10.00","itemTax":"","itemTaxRate":"","totalAmount":"1000.00","pgiDate":""},{"invoiceID":"60961-ROC","invoiceItemIndex":2,"invoiceStatus":"In_Progress","documentType":"","documentDate":"","invoiceDate":"2019-5-16","postingDate":"","invoicingParty":"","companyCode":"","paymentCurrency":"USD","invoiceType":"","headerText":"","supplierNumber":"","paymentMethod":"","paymentBlock":"","partnerBank":"","houseBank":"","houseBankAccountID":"","paymentMethodSupp":"","autoCalculateTaxIndicator":"","totalTaxAmount":"","taxJurisdiction":"","baselineDate":"","dueDate":"","vatAmount":"","vatAmount1":"","vatAmount2":"","vatAmount3":"","vatAmount4":"","vatRate":"","vatRate1":"","vatRate2":"","vatRate3":"","vatRate4":"","paymentTerms":"Net due in 30 days","day1":"","day2":"","day3":"","discount1":"","discount2":"","exchangeRate":"","withholdingTax":"","unplannedDeliveryCost":"","instanceKey":"","bankAccount":"","bankName":"","bankNumber":"","bankPartnerType":"","vatID":"","vatID1":"","vatID2":"","vatID3":"","vatID4":"","requestorEmail":"","invoiceFreightAmount":"","invoiceHandlingCharges":"","alternatePayee":"","documentItemInInvoice":"","purchaseOrder":"4500280896","itemPurchaseOrder":"","uomPurchaseOrder":"","amountDocumentCurrency":"","deliveryNoteNumber":"","materialNumber":"","taxCode":"","accountAssigned":"","directPostingGL":"","directPostingMaterial":"","lastUser":"","currentUser":"","lastUpdatedTS":"","lastRole":"","invoiceCategory":"","shipToAddress1":"Plant 1","shipToAddress2":"3475 Deer Creek","billToCompany":"TCL USA","billToName":"","billToPhone":"","billToAddress1":"Head Office","billToAddress2":"3475 Deer Creek","billToCountry":"USA","billToVAT":"","billToEmail":"","remitName":"KMM Corporation","remitToAddress1":"Shanghai","remitToAddress2":"CHINA 12345","remitToPin":"","remitToStreet":"Street 123","remitToVAT":"","remitToEmail":"","remitToPhone":"","supplierName":"","supplierName2":"","supplierPOBox":"","supplierPOBoxZip":"","supplierStreet":"","supplierState":"","supplierZip":"","netAmount":"","ibanNumber":"","swiftCode":"","grossAmount":"1010","glAccount":"","glDescription":"","costCenter":"","costCenterDescription":"","wbsElement":"","wbsElementDescription":"","internalOrder":"","internalOrderDescription":"","assetID":"","assetDescription":"","invoiceFileName":"https://s3.amazonaws.com/subscriptionbasedintelligent-app/invoice_1558007696198.jpg","postedInvoice":"","invoiceGUID":"0ef7906b-6b01-4680-8a61-113d4bfb20e0","itemNumber":"","itemCode":"NA","itemDescription":"Shipping","itemQuantity":"1.00","unitPrice":"10.00","itemUnit":"","itemQuantityShipped":"10.00","itemTax":"","itemTaxRate":"","totalAmount":"10.00","pgiDate":""}]};
//const input={"invoiceItems":[{"invoiceID":"60961-ROC","invoiceItemIndex":1,"invoiceStatus":"Scanned","documentType":"","documentDate":"2019-5-13","invoiceDate":"2019-5-23","postingDate":"","invoicingParty":"","companyCode":"","paymentCurrency":"USD","invoiceType":"","headerText":"","supplierNumber":"","paymentMethod":"","paymentBlock":"","partnerBank":"","houseBank":"","houseBankAccountID":"","paymentMethodSupp":"","autoCalculateTaxIndicator":"true","totalTaxAmount":"3.00","taxJurisdiction":"","baselineDate":"","dueDate":"","vatAmount":"","vatAmount1":"","vatAmount2":"","vatAmount3":"","vatAmount4":"","vatRate":"","vatRate1":"","vatRate2":"","vatRate3":"","vatRate4":"","paymentTerms":"Net due in 30 days","day1":"","day2":"","day3":"","discount1":"","discount2":"","exchangeRate":"","withholdingTax":"","unplannedDeliveryCost":"","instanceKey":"","bankAccount":"","bankName":"","bankNumber":"","bankPartnerType":"","vatID":"","vatID1":"","vatID2":"","vatID3":"","vatID4":"","requestorEmail":"","invoiceFreightAmount":"5.00","invoiceHandlingCharges":"","alternatePayee":"","documentItemInInvoice":"","purchaseOrder":"4500280896","itemPurchaseOrder":"","uomPurchaseOrder":"","amountDocumentCurrency":"","deliveryNoteNumber":"","materialNumber":"","taxCode":"","accountAssigned":"","directPostingGL":"","directPostingMaterial":"","lastUser":"","currentUser":"","lastUpdatedTS":"","lastRole":"","invoiceCategory":"","shipToAddress1":"Plant 1","shipToAddress2":"3475 Deerk Creek","billToCompany":"TCL USA","billToName":"TCL USA","billToPhone":"","billToAddress1":"Head Office","billToAddress2":"3475 Deer Creek","billToCountry":"USA","billToVAT":"","billToEmail":"","remitName":"KMM Corporation","remitToAddress1":"Shanghai","remitToAddress2":"CHINA","remitToPin":"12345","remitToStreet":"Street 123","remitToVAT":"","remitToEmail":"","remitToPhone":"","supplierName":"","supplierName2":"","supplierPOBox":"USA","supplierPOBoxZip":"94304-1355","supplierStreet":"New York NY","supplierState":"New York NY","supplierZip":"94304-1355","netAmount":"","ibanNumber":"","swiftCode":"","grossAmount":"1018","glAccount":"","glDescription":"","costCenter":"","costCenterDescription":"","wbsElement":"","wbsElementDescription":"","internalOrder":"","internalOrderDescription":"","assetID":"","assetDescription":"","invoiceFileName":"https://s3.amazonaws.com/subscriptionbasedintelligent-app/invoice_1558608378465.jpg","postedInvoice":"","invoiceGUID":"980569cc-0e17-4299-a512-ca97dcc9b4de","itemNumber":"","itemCode":"1033021 -002","itemDescription":"Officesuppies","itemQuantity":"100.00","unitPrice":"10.00","itemUnit":"","itemQuantityShipped":"10.00","itemTax":"","itemTaxRate":"","totalAmount":"1000.00","pgiDate":""},{"invoiceID":"60961-ROC","invoiceItemIndex":2,"invoiceStatus":"Scanned","documentType":"","documentDate":"2019-5-13","invoiceDate":"2019-5-23","postingDate":"","invoicingParty":"","companyCode":"","paymentCurrency":"USD","invoiceType":"","headerText":"","supplierNumber":"","paymentMethod":"","paymentBlock":"","partnerBank":"","houseBank":"","houseBankAccountID":"","paymentMethodSupp":"","autoCalculateTaxIndicator":"true","totalTaxAmount":"3.00","taxJurisdiction":"","baselineDate":"","dueDate":"","vatAmount":"","vatAmount1":"","vatAmount2":"","vatAmount3":"","vatAmount4":"","vatRate":"","vatRate1":"","vatRate2":"","vatRate3":"","vatRate4":"","paymentTerms":"Net due in 30 days","day1":"","day2":"","day3":"","discount1":"","discount2":"","exchangeRate":"","withholdingTax":"","unplannedDeliveryCost":"","instanceKey":"","bankAccount":"","bankName":"","bankNumber":"","bankPartnerType":"","vatID":"","vatID1":"","vatID2":"","vatID3":"","vatID4":"","requestorEmail":"","invoiceFreightAmount":"5.00","invoiceHandlingCharges":"","alternatePayee":"","documentItemInInvoice":"","purchaseOrder":"4500280896","itemPurchaseOrder":"","uomPurchaseOrder":"","amountDocumentCurrency":"","deliveryNoteNumber":"","materialNumber":"","taxCode":"","accountAssigned":"","directPostingGL":"","directPostingMaterial":"","lastUser":"","currentUser":"","lastUpdatedTS":"","lastRole":"","invoiceCategory":"","shipToAddress1":"Plant 1","shipToAddress2":"3475 Deedfgr Creek","billToCompany":"TCL USA","billToName":"TCL USA","billToPhone":"","billToAddress1":"Head Office","billToAddress2":"3475 Deer Creek","billToCountry":"USA","billToVAT":"","billToEmail":"","remitName":"KMM Corporation","remitToAddress1":"Shanghai","remitToAddress2":"CHINA","remitToPin":"12345","remitToStreet":"Street 124563","remitToVAT":"","remitToEmail":"","remitToPhone":"","supplierName":"","supplierName2":"","supplierPOBox":"USA","supplierPOBoxZip":"94304-1355","supplierStreet":"New York NY","supplierState":"New York NY","supplierZip":"94304-1355","netAmount":"","ibanNumber":"","swiftCode":"","grossAmount":"1018","glAccount":"","glDescription":"","costCenter":"","costCenterDescription":"","wbsElement":"","wbsElementDescription":"","internalOrder":"","internalOrderDescription":"","assetID":"","assetDescription":"","invoiceFileName":"https://s3.amazonaws.com/subscriptionbasedintelligent-app/invoice_1558608378465.jpg","postedInvoice":"","invoiceGUID":"980569cc-0e17-4299-a512-ca97dcc9b4de","itemNumber":"","itemCode":"NA","itemDescription":"Shipping","itemQuantity":"1.00","unitPrice":"10.00","itemUnit":"","itemQuantityShipped":"10.00","itemTax":"","itemTaxRate":"","totalAmount":"10.00","pgiDate":""}]};
//const input={"invoiceItems":[{"invoiceID":"60961-ROC","invoiceItemIndex":1,"invoiceStatus":"In_Progress","documentType":"ZPOM","documentDate":"2019-5-13","invoiceDate":"2019-5-29","postingDate":"20190602","invoicingParty":"VENDOR1","companyCode":"ZH01","paymentCurrency":"USD","invoiceType":"","headerText":"","supplierNumber":"VENDOR1","paymentMethod":"","paymentBlock":"","partnerBank":"","houseBank":"","houseBankAccountID":"","paymentMethodSupp":"","autoCalculateTaxIndicator":"true","totalTaxAmount":"","taxJurisdiction":"CA0000000","baselineDate":"2019-05-13","dueDate":"2019-05-13","vatAmount":"","vatAmount1":"","vatAmount2":"","vatAmount3":"","vatAmount4":"","vatRate":"","vatRate1":"","vatRate2":"","vatRate3":"","vatRate4":"","paymentTerms":"Net due in 30 days","day1":"015","day2":"030","day3":"000","discount1":"10.000 ","discount2":"0.000 ","exchangeRate":"","withholdingTax":"","unplannedDeliveryCost":"","instanceKey":"","bankAccount":"1234567890","bankName":"Bank of America","bankNumber":"011501035","bankPartnerType":"0001","vatID":"","vatID1":"","vatID2":"","vatID3":"","vatID4":"","requestorEmail":"","invoiceFreightAmount":"0.00","invoiceHandlingCharges":"","alternatePayee":"","documentItemInInvoice":"","purchaseOrder":"4500281575","itemPurchaseOrder":"","uomPurchaseOrder":"","amountDocumentCurrency":"","deliveryNoteNumber":"","materialNumber":"","taxCode":"","accountAssigned":"","directPostingGL":"","directPostingMaterial":"","lastUser":"","currentUser":"","lastUpdatedTS":"","lastRole":"","invoiceCategory":"","shipToAddress1":"Plant 1","shipToAddress2":"3475 Deer Creek","billToCompany":"TCL USA","billToName":"TCL USA","billToPhone":"","billToAddress1":"Head Office","billToAddress2":"3475 Deer Creek","billToCountry":"USA","billToVAT":"","billToEmail":"NT30","remitName":"KMM Corporation","remitToAddress1":"SHANGHAI","remitToAddress2":"CN","remitToPin":"12345","remitToStreet":"STREET123","remitToVAT":"","remitToEmail":"","remitToPhone":"","supplierName":"Symantec Corp","supplierName2":"VENDOR2","supplierPOBox":"USA","supplierPOBoxZip":"94304-1355","supplierStreet":"New York NY","supplierState":"New York NY","supplierZip":"94304-1355","netAmount":"1010.00 ","ibanNumber":"","swiftCode":"","grossAmount":"1010","glAccount":"","glDescription":"","costCenter":"","costCenterDescription":"","wbsElement":"","wbsElementDescription":"","internalOrder":"","internalOrderDescription":"","assetID":"","assetDescription":"","invoiceFileName":"https://s3.amazonaws.com/subscriptionbasedintelligent-app/invoice_1559149905277.jpg","postedInvoice":"","invoiceGUID":"4099b279-4c45-4d5d-91a4-32b4feeb869a","itemNumber":"00010","itemCode":"","itemDescription":"Office Supplies","itemQuantity":"10.00","unitPrice":"100.00","itemUnit":"EA","itemQuantityShipped":"10.00","itemTax":"U0","itemTaxRate":"","totalAmount":"1000.00","pgiDate":""},{"invoiceID":"60961-ROC","invoiceItemIndex":2,"invoiceStatus":"In_Progress","documentType":"ZPOM","documentDate":"2019-5-13","invoiceDate":"2019-5-29","postingDate":"20190602","invoicingParty":"VENDOR1","companyCode":"ZH01","paymentCurrency":"USD","invoiceType":"","headerText":"","supplierNumber":"VENDOR1","paymentMethod":"","paymentBlock":"","partnerBank":"","houseBank":"","houseBankAccountID":"","paymentMethodSupp":"","autoCalculateTaxIndicator":"true","totalTaxAmount":"","taxJurisdiction":"CA0000000","baselineDate":"2019-05-13","dueDate":"2019-05-13","vatAmount":"","vatAmount1":"","vatAmount2":"","vatAmount3":"","vatAmount4":"","vatRate":"","vatRate1":"","vatRate2":"","vatRate3":"","vatRate4":"","paymentTerms":"Net due in 30 days","day1":"015","day2":"030","day3":"000","discount1":"10.000 ","discount2":"0.000 ","exchangeRate":"","withholdingTax":"","unplannedDeliveryCost":"","instanceKey":"","bankAccount":"1234567890","bankName":"Bank of America","bankNumber":"011501035","bankPartnerType":"0001","vatID":"","vatID1":"","vatID2":"","vatID3":"","vatID4":"","requestorEmail":"","invoiceFreightAmount":"0.00","invoiceHandlingCharges":"","alternatePayee":"","documentItemInInvoice":"","purchaseOrder":"4500281575","itemPurchaseOrder":"","uomPurchaseOrder":"","amountDocumentCurrency":"","deliveryNoteNumber":"","materialNumber":"","taxCode":"","accountAssigned":"","directPostingGL":"","directPostingMaterial":"","lastUser":"","currentUser":"","lastUpdatedTS":"","lastRole":"","invoiceCategory":"","shipToAddress1":"Plant 1","shipToAddress2":"3475 Deer Creek","billToCompany":"TCL USA","billToName":"TCL USA","billToPhone":"","billToAddress1":"Head Office","billToAddress2":"3475 Deer Creek","billToCountry":"USA","billToVAT":"","billToEmail":"NT30","remitName":"KMM Corporation","remitToAddress1":"SHANGHAI","remitToAddress2":"CN","remitToPin":"12345","remitToStreet":"STREET123","remitToVAT":"","remitToEmail":"","remitToPhone":"","supplierName":"Symantec Corp","supplierName2":"VENDOR2","supplierPOBox":"USA","supplierPOBoxZip":"94304-1355","supplierStreet":"New York NY","supplierState":"New York NY","supplierZip":"94304-1355","netAmount":"1010.00 ","ibanNumber":"","swiftCode":"","grossAmount":"1010","glAccount":"","glDescription":"","costCenter":"","costCenterDescription":"","wbsElement":"","wbsElementDescription":"","internalOrder":"","internalOrderDescription":"","assetID":"","assetDescription":"","invoiceFileName":"https://s3.amazonaws.com/subscriptionbasedintelligent-app/invoice_1559149905277.jpg","postedInvoice":"","invoiceGUID":"4099b279-4c45-4d5d-91a4-32b4feeb869a","itemNumber":"00020","itemCode":"","itemDescription":"Shipping","itemQuantity":"1.00","unitPrice":"10.00","itemUnit":"AU","itemQuantityShipped":"10.00","itemTax":"U0","itemTaxRate":"","totalAmount":"10.00","pgiDate":""}]};
const input={"invoiceItems":[{"invoiceID":"60961-ROC","invoiceItemIndex":1,"invoiceStatus":"Scanned","documentType":"","documentDate":"2019-5-13","invoiceDate":"2019-6-10","postingDate":"","invoicingParty":"","companyCode":"","paymentCurrency":"USD","invoiceType":"","headerText":"","supplierNumber":"","paymentMethod":"","paymentBlock":"","partnerBank":"","houseBank":"","houseBankAccountID":"","paymentMethodSupp":"","autoCalculateTaxIndicator":"false","baselineDate":"","dueDate":"","vatAmount":"","vatAmount1":"","vatAmount2":"","vatAmount3":"","vatAmount4":"","vatRate":"","vatRate1":"","vatRate2":"","vatRate3":"","vatRate4":"","paymentTerms":"Net due in 30 days","day1":"","day2":"","day3":"","discount1":"","discount2":"","exchangeRate":"","withholdingTax":"","unplannedDeliveryCost":"","instanceKey":"","bankAccount":"","bankName":"","bankNumber":"","bankPartnerType":"","vatID":"","vatID1":"","vatID2":"","vatID3":"","vatID4":"","requestorEmail":"","invoiceFreightAmount":"5.00","invoiceHandlingCharges":"","alternatePayee":"","documentItemInInvoice":"","purchaseOrder":"4500280896","itemPurchaseOrder":"","uomPurchaseOrder":"","amountDocumentCurrency":"","deliveryNoteNumber":"","materialNumber":"","taxCode":"","accountAssigned":"","directPostingGL":"","directPostingMaterial":"","lastUser":"","currentUser":"","lastUpdatedTS":"","lastRole":"","invoiceCategory":"","shipToAddress1":"Plant 1","shipToAddress2":"3475 Deer Creek","billToCompany":"TCL USA","billToName":"TCL USA","billToPhone":"","billToAddress1":"Head Office","billToAddress2":"3475 Deer Creek","billToCountry":"USA","billToVAT":"","billToEmail":"","remitName":"KMM Corporation","remitToAddress1":"Shanghai","remitToAddress2":"CHINA","remitToPin":"12345","remitToStreet":"Street 123","remitToVAT":"","remitToEmail":"","remitToPhone":"","supplierName":"","supplierName2":"","supplierPOBox":"USA","supplierPOBoxZip":"94304-1355","supplierStreet":"New York NY","supplierState":"New York NY","supplierZip":"94304-1355","netAmount":"","ibanNumber":"","swiftCode":"","grossAmount":"1018","glAccount":"","glDescription":"","costCenter":"","costCenterDescription":"","wbsElement":"","wbsElementDescription":"","internalOrder":"","internalOrderDescription":"","assetID":"","assetDescription":"","invoiceFileName":"https://s3.amazonaws.com/subscriptionbasedintelligent-app/invoice_1560179940654.jpg","postedInvoice":"","invoiceGUID":"54d88c3f-c9cc-4221-94f0-5b3974ba3685","itemNumber":"","itemCode":"1033021-002","itemDescription":"Office Supples","itemQuantity":"100.00","unitPrice":"10.00","itemUnit":"","itemQuantityShipped":"10.00","itemTax":"","taxJurisdiction":"","itemTaxRate":"","totalAmount":"1000.00","pgiDate":"","totalTaxAmount":"3.00"},{"invoiceID":"60961-ROC","invoiceItemIndex":2,"invoiceStatus":"Scanned","documentType":"","documentDate":"2019-5-13","invoiceDate":"2019-6-10","postingDate":"","invoicingParty":"","companyCode":"","paymentCurrency":"USD","invoiceType":"","headerText":"","supplierNumber":"","paymentMethod":"","paymentBlock":"","partnerBank":"","houseBank":"","houseBankAccountID":"","paymentMethodSupp":"","autoCalculateTaxIndicator":"false","baselineDate":"","dueDate":"","vatAmount":"","vatAmount1":"","vatAmount2":"","vatAmount3":"","vatAmount4":"","vatRate":"","vatRate1":"","vatRate2":"","vatRate3":"","vatRate4":"","paymentTerms":"Net due in 30 days","day1":"","day2":"","day3":"","discount1":"","discount2":"","exchangeRate":"","withholdingTax":"","unplannedDeliveryCost":"","instanceKey":"","bankAccount":"","bankName":"","bankNumber":"","bankPartnerType":"","vatID":"","vatID1":"","vatID2":"","vatID3":"","vatID4":"","requestorEmail":"","invoiceFreightAmount":"5.00","invoiceHandlingCharges":"","alternatePayee":"","documentItemInInvoice":"","purchaseOrder":"4500280896","itemPurchaseOrder":"","uomPurchaseOrder":"","amountDocumentCurrency":"","deliveryNoteNumber":"","materialNumber":"","taxCode":"","accountAssigned":"","directPostingGL":"","directPostingMaterial":"","lastUser":"","currentUser":"","lastUpdatedTS":"","lastRole":"","invoiceCategory":"","shipToAddress1":"Plant 1","shipToAddress2":"3475 Deer Creek","billToCompany":"TCL USA","billToName":"TCL USA","billToPhone":"","billToAddress1":"Head Office","billToAddress2":"3475 Deer Creek","billToCountry":"USA","billToVAT":"","billToEmail":"","remitName":"KMM Corporation","remitToAddress1":"Shanghai","remitToAddress2":"CHINA","remitToPin":"12345","remitToStreet":"Street 123","remitToVAT":"","remitToEmail":"","remitToPhone":"","supplierName":"","supplierName2":"","supplierPOBox":"USA","supplierPOBoxZip":"94304-1355","supplierStreet":"New York NY","supplierState":"New York NY","supplierZip":"94304-1355","netAmount":"","ibanNumber":"","swiftCode":"","grossAmount":"1018","glAccount":"","glDescription":"","costCenter":"","costCenterDescription":"","wbsElement":"","wbsElementDescription":"","internalOrder":"","internalOrderDescription":"","assetID":"","assetDescription":"","invoiceFileName":"https://s3.amazonaws.com/subscriptionbasedintelligent-app/invoice_1560179940654.jpg","postedInvoice":"","invoiceGUID":"54d88c3f-c9cc-4221-94f0-5b3974ba3685","itemNumber":"","itemCode":"NA","itemDescription":"Shipping","itemQuantity":"1.00","unitPrice":"10.00","itemUnit":"","itemQuantityShipped":"10.00","itemTax":"","taxJurisdiction":"","itemTaxRate":"","totalAmount":"10.00","pgiDate":"","totalTaxAmount":"3.00"}]};
//const output={"updatedInvoiceItems":[{"postedInvoice":"","invoiceFileName":"https://s3.amazonaws.com/subscriptionbasedintelligent-app/invoice_1559877756417.jpg","assetDescription":"","assetID":"","internalOrderDescription":"","internalOrder":"","wbsElementDescription":"","wbsElement":"","costCenterDescription":"","costCenter":"","glDescription":"","glAccount":"","itemCode":"","pgiDate":"","totalAmount":"1200.00","itemUnit":"EA","itemTaxRate":"","itemTax":"I1","itemQuantityShipped":"10.00","itemQuantity":"100.00","itemPrice":"10.00","unitPrice":"12.00","itemDescription":"Office Supplies","itemNumber":"00010","grossAmount":"1018","swiftCode":"","ibanNumber":"","netAmount":"1210.00 ","supplierZip":"94304-1355","supplierState":"New York NY","supplierStreet":"New York NY","supplierPOBoxZip":"94304-1355","supplierPOBox":"USA","supplierName2":"VENDOR2","supplierName":"Symantec Corp","remitToPhone":"","remitToEmail":"","remitToVAT":"","remitToStreet":"STREET123","remitToPin":"12345","remitToAddress2":"CN","remitToAddress1":"SHANGHAI","remitName":"KMM Corporation","billToEmail":"NT30","billToVAT":"","billToCountry":"USA","billToAddress2":"3475 Deer Creek","billToAddress1":"Head Office","billToPhone":"","billToName":"TCL USA","billToCompany":"TCL USA","shipToAddress2":"3475 Deer Creek","shipToAddress1":"Plant 1","invoiceCategory":"","lastRole":"","lastUpdatedTS":"","currentUser":"","lastUser":"","directPostingMaterial":"","directPostingGL":"","accountAssigned":"","taxCode":"","materialNumber":"","deliveryNoteNumber":"","amountDocumentCurrency":"","uomPurchaseOrder":"","itemPurchaseOrder":"","purchaseOrder":"4500281584","documentItemInInvoice":"","alternatePayee":"","invoiceHandlingCharges":"","invoiceFreightAmount":"5.00","requestorEmail":"","vatID4":"","vatID3":"","vatID2":"","vatID1":"","vatID":"","bankPartnerType":"0001","bankNumber":"011501035","bankName":"Bank of America","bankAccount":"1234567890","instanceKey":"","unplannedDeliveryCost":"","withholdingTax":"","exchangeRate":"","discount2":"0.000 ","discount1":"10.000 ","day3":"000","day2":"030","day1":"015","paymentTerms":"Net due in 30 days","vatRate4":"","vatRate3":"","vatRate2":"","vatRate1":"","vatRate":"","vatAmount4":"","vatAmount3":"","vatAmount2":"","vatAmount1":"","vatAmount":"","dueDate":"2019-05-13","baselineDate":"2019-05-13","taxJurisdiction":"CA0000000","totalTaxAmount":"3.00","autoCalculateTaxIndicator":"false","paymentMethodSupp":"","houseBankAccountID":"","houseBank":"","partnerBank":"","paymentBlock":"","paymentMethod":"","supplierNumber":"VENDOR1","headerText":"","invoiceType":"","paymentCurrency":"USD","companyCode":"ZH01","invoicingParty":"VENDOR1","postingDate":"20190612","invoiceDate":"2019-6-7","documentDate":"2019-5-13","invoiceUploadTS":"Fri, 07 Jun 2019 03:23:09 GMT","documentType":"ZPOM","invoiceStatus":"In_Progress","invoiceItemIndex":"1","invoiceID":"60961-ROC","invoiceGUID":"6d87753d-b3fa-44e7-b175-446ff3159dfe"},{"postedInvoice":"","invoiceFileName":"https://s3.amazonaws.com/subscriptionbasedintelligent-app/invoice_1559877756417.jpg","assetDescription":"","assetID":"","internalOrderDescription":"","internalOrder":"","wbsElementDescription":"","wbsElement":"","costCenterDescription":"","costCenter":"","glDescription":"","glAccount":"","itemCode":"","pgiDate":"","totalAmount":"10.00","itemUnit":"KG","itemTaxRate":"","itemTax":"U0","itemQuantityShipped":"10.00","itemQuantity":"1.00","itemPrice":"10.00","unitPrice":"10.00","itemDescription":"Shipping","itemNumber":"00020","grossAmount":"1018","swiftCode":"","ibanNumber":"","netAmount":"1210.00 ","supplierZip":"94304-1355","supplierState":"New York NY","supplierStreet":"New York NY","supplierPOBoxZip":"94304-1355","supplierPOBox":"USA","supplierName2":"VENDOR2","supplierName":"Symantec Corp","remitToPhone":"","remitToEmail":"","remitToVAT":"","remitToStreet":"STREET123","remitToPin":"12345","remitToAddress2":"CN","remitToAddress1":"SHANGHAI","remitName":"KMM Corporation","billToEmail":"NT30","billToVAT":"","billToCountry":"USA","billToAddress2":"3475 Deer Creek","billToAddress1":"Head Office","billToPhone":"","billToName":"TCL USA","billToCompany":"TCL USA","shipToAddress2":"3475 Deer Creek","shipToAddress1":"Plant 1","invoiceCategory":"","lastRole":"","lastUpdatedTS":"","currentUser":"","lastUser":"","directPostingMaterial":"","directPostingGL":"","accountAssigned":"","taxCode":"","materialNumber":"","deliveryNoteNumber":"","amountDocumentCurrency":"","uomPurchaseOrder":"","itemPurchaseOrder":"","purchaseOrder":"4500281584","documentItemInInvoice":"","alternatePayee":"","invoiceHandlingCharges":"","invoiceFreightAmount":"5.00","requestorEmail":"","vatID4":"","vatID3":"","vatID2":"","vatID1":"","vatID":"","bankPartnerType":"0001","bankNumber":"011501035","bankName":"Bank of America","bankAccount":"1234567890","instanceKey":"","unplannedDeliveryCost":"","withholdingTax":"","exchangeRate":"","discount2":"0.000 ","discount1":"10.000 ","day3":"000","day2":"030","day1":"015","paymentTerms":"Net due in 30 days","vatRate4":"","vatRate3":"","vatRate2":"","vatRate1":"","vatRate":"","vatAmount4":"","vatAmount3":"","vatAmount2":"","vatAmount1":"","vatAmount":"","dueDate":"2019-05-13","baselineDate":"2019-05-13","taxJurisdiction":"CA0000000","totalTaxAmount":"3.00","autoCalculateTaxIndicator":"false","paymentMethodSupp":"","houseBankAccountID":"","houseBank":"","partnerBank":"","paymentBlock":"","paymentMethod":"","supplierNumber":"VENDOR1","headerText":"","invoiceType":"","paymentCurrency":"USD","companyCode":"ZH01","invoicingParty":"VENDOR1","postingDate":"20190612","invoiceDate":"2019-6-7","documentDate":"2019-5-13","invoiceUploadTS":"Fri, 07 Jun 2019 03:23:09 GMT","documentType":"ZPOM","invoiceStatus":"In_Progress","invoiceItemIndex":"2","invoiceID":"60961-ROC","invoiceGUID":"6d87753d-b3fa-44e7-b175-446ff3159dfe"}],"exceptions":[{"exceptionMessage":"Item1:Total amount1200.00more than tolerance limit amount","exceptionIndex":"0","invoiceGUID":"6d87753d-b3fa-44e7-b175-446ff3159dfe"},{"exceptionMessage":"Invoice Gross amount ''1018''does not match Invoice line item total amount''1218.00''","exceptionIndex":"1","invoiceGUID":"6d87753d-b3fa-44e7-b175-446ff3159dfe"},{"exceptionMessage":"Item2:Unit of Measure Mismatch","exceptionIndex":"2","invoiceGUID":"6d87753d-b3fa-44e7-b175-446ff3159dfe"},{"exceptionMessage":"Item2:Insufficient Quantity in PO","exceptionIndex":"3","invoiceGUID":"6d87753d-b3fa-44e7-b175-446ff3159dfe"}]};
//const input={"invoiceItems":[{"invoiceID":"60961-ROC","invoiceItemIndex":1,"invoiceStatus":"In_Progress","documentType":"ZPOM","documentDate":"2019-5-13","invoiceDate":"2019-6-7","postingDate":"20190612","invoicingParty":"VENDOR1","companyCode":"ZH01","paymentCurrency":"USD","invoiceType":"","headerText":"","supplierNumber":"VENDOR1","paymentMethod":"","paymentBlock":"","partnerBank":"","houseBank":"","houseBankAccountID":"","paymentMethodSupp":"","autoCalculateTaxIndicator":"false","baselineDate":"2019-05-13","dueDate":"2019-05-13","vatAmount":"","vatAmount1":"","vatAmount2":"","vatAmount3":"","vatAmount4":"","vatRate":"","vatRate1":"","vatRate2":"","vatRate3":"","vatRate4":"","paymentTerms":"Net due in 30 days","day1":"015","day2":"030","day3":"000","discount1":"10.000 ","discount2":"0.000 ","exchangeRate":"","withholdingTax":"","unplannedDeliveryCost":"","instanceKey":"","bankAccount":"1234567890","bankName":"Bank of America","bankNumber":"011501035","bankPartnerType":"0001","vatID":"","vatID1":"","vatID2":"","vatID3":"","vatID4":"","requestorEmail":"","invoiceFreightAmount":"5.00","invoiceHandlingCharges":"","alternatePayee":"","documentItemInInvoice":"","purchaseOrder":"4500281584","itemPurchaseOrder":"","uomPurchaseOrder":"","amountDocumentCurrency":"","deliveryNoteNumber":"","materialNumber":"","taxCode":"","accountAssigned":"","directPostingGL":"","directPostingMaterial":"","lastUser":"","currentUser":"","lastUpdatedTS":"","lastRole":"","invoiceCategory":"","shipToAddress1":"Plant 1","shipToAddress2":"3475 Deer Creek","billToCompany":"TCL USA","billToName":"TCL USA","billToPhone":"","billToAddress1":"Head Office","billToAddress2":"3475 Deer Creek","billToCountry":"USA","billToVAT":"","billToEmail":"NT30","remitName":"KMM Corporation","remitToAddress1":"SHANGHAI","remitToAddress2":"CN","remitToPin":"12345","remitToStreet":"STREET123","remitToVAT":"","remitToEmail":"","remitToPhone":"","supplierName":"Symantec Corp","supplierName2":"VENDOR2","supplierPOBox":"USA","supplierPOBoxZip":"94304-1355","supplierStreet":"New York NY","supplierState":"New York NY","supplierZip":"94304-1355","netAmount":"1210.00 ","ibanNumber":"","swiftCode":"","grossAmount":"1018","glAccount":"","glDescription":"","costCenter":"","costCenterDescription":"","wbsElement":"","wbsElementDescription":"","internalOrder":"","internalOrderDescription":"","assetID":"","assetDescription":"","invoiceFileName":"https://s3.amazonaws.com/subscriptionbasedintelligent-app/invoice_1559877756417.jpg","postedInvoice":"","invoiceGUID":"6d87753d-b3fa-44e7-b175-446ff3159dfe","itemNumber":"00010","itemCode":"","itemDescription":"Office Supplies","itemQuantity":"100.00","unitPrice":"12.00","itemUnit":"EA","itemQuantityShipped":"10.00","itemTax":"I1","taxJurisdiction":"CA0000000","itemTaxRate":"","totalAmount":"1200.00","pgiDate":"","totalTaxAmount":"3.00"},{"invoiceID":"60961-ROC","invoiceItemIndex":2,"invoiceStatus":"In_Progress","documentType":"ZPOM","documentDate":"2019-5-13","invoiceDate":"2019-6-7","postingDate":"20190612","invoicingParty":"VENDOR1","companyCode":"ZH01","paymentCurrency":"USD","invoiceType":"","headerText":"","supplierNumber":"VENDOR1","paymentMethod":"","paymentBlock":"","partnerBank":"","houseBank":"","houseBankAccountID":"","paymentMethodSupp":"","autoCalculateTaxIndicator":"false","baselineDate":"2019-05-13","dueDate":"2019-05-13","vatAmount":"","vatAmount1":"","vatAmount2":"","vatAmount3":"","vatAmount4":"","vatRate":"","vatRate1":"","vatRate2":"","vatRate3":"","vatRate4":"","paymentTerms":"Net due in 30 days","day1":"015","day2":"030","day3":"000","discount1":"10.000 ","discount2":"0.000 ","exchangeRate":"","withholdingTax":"","unplannedDeliveryCost":"","instanceKey":"","bankAccount":"1234567890","bankName":"Bank of America","bankNumber":"011501035","bankPartnerType":"0001","vatID":"","vatID1":"","vatID2":"","vatID3":"","vatID4":"","requestorEmail":"","invoiceFreightAmount":"5.00","invoiceHandlingCharges":"","alternatePayee":"","documentItemInInvoice":"","purchaseOrder":"4500281584","itemPurchaseOrder":"","uomPurchaseOrder":"","amountDocumentCurrency":"","deliveryNoteNumber":"","materialNumber":"","taxCode":"","accountAssigned":"","directPostingGL":"","directPostingMaterial":"","lastUser":"","currentUser":"","lastUpdatedTS":"","lastRole":"","invoiceCategory":"","shipToAddress1":"Plant 1","shipToAddress2":"3475 Deer Creek","billToCompany":"TCL USA","billToName":"TCL USA","billToPhone":"","billToAddress1":"Head Office","billToAddress2":"3475 Deer Creek","billToCountry":"USA","billToVAT":"","billToEmail":"NT30","remitName":"KMM Corporation","remitToAddress1":"SHANGHAI","remitToAddress2":"CN","remitToPin":"12345","remitToStreet":"STREET123","remitToVAT":"","remitToEmail":"","remitToPhone":"","supplierName":"Symantec Corp","supplierName2":"VENDOR2","supplierPOBox":"USA","supplierPOBoxZip":"94304-1355","supplierStreet":"New York NY","supplierState":"New York NY","supplierZip":"94304-1355","netAmount":"1210.00 ","ibanNumber":"","swiftCode":"","grossAmount":"1018","glAccount":"","glDescription":"","costCenter":"","costCenterDescription":"","wbsElement":"","wbsElementDescription":"","internalOrder":"","internalOrderDescription":"","assetID":"","assetDescription":"","invoiceFileName":"https://s3.amazonaws.com/subscriptionbasedintelligent-app/invoice_1559877756417.jpg","postedInvoice":"","invoiceGUID":"6d87753d-b3fa-44e7-b175-446ff3159dfe","itemNumber":"00020","itemCode":"","itemDescription":"Shipping","itemQuantity":"1.00","unitPrice":"10.00","itemUnit":"KG","itemQuantityShipped":"10.00","itemTax":"U0","taxJurisdiction":"CA0000000","itemTaxRate":"","totalAmount":"10.00","pgiDate":"","totalTaxAmount":"3.00"}]};
//const output=[{"exceptionMessage":"Item1:Total amount1200.00more than tolerance limit amount","exceptionIndex":"0","invoiceGUID":"6d87753d-b3fa-44e7-b175-446ff3159dfe"},{"exceptionMessage":"Invoice Gross amount ''1018''does not match Invoice line item total amount''1218.00''","exceptionIndex":"1","invoiceGUID":"6d87753d-b3fa-44e7-b175-446ff3159dfe"},{"exceptionMessage":"Item2:Unit of Measure Mismatch","exceptionIndex":"2","invoiceGUID":"6d87753d-b3fa-44e7-b175-446ff3159dfe"},{"exceptionMessage":"Item2:Insufficient Quantity in PO","exceptionIndex":"3","invoiceGUID":"6d87753d-b3fa-44e7-b175-446ff3159dfe"}];
function convertItemsToGWServicePayload(invoiceItems) {
	var i, invoiceItem, gwInvoiceItems = [], gwInvoiceItem;

	for (i = 0; i < invoiceItems.length; i++) {
		invoiceItem = invoiceItems[i];

		gwInvoiceItem = {
				ZimageFingerprint: invoiceItem.invoiceGUID,
				Zinvno: invoiceItem.invoiceID,
				Zitemindex: invoiceItem.invoiceItemIndex,
				ZdocType : invoiceItem.documentType,
				ZdocDate : invoiceItem.documentDate,
				Zinvdate : invoiceItem.invoiceDate,
				// ZpostingDate: "",
				ZinvoicingParty : invoiceItem.invoicingParty,
				ZcompanyCode : invoiceItem.companyCode,
				Zcurrency : invoiceItem.paymentCurrency,
				// "ZinvType": "",
				// "ZheaderText": "",
				ZvendorNo : invoiceItem.supplierNumber,
				// "ZpaymentMethod": "",
				// "ZpaymentBlock": "",
				// "ZpartnerBank": "",
				// "ZhouseBank": "",
				// "ZhouseBankAccid": "",
				// "ZpaymentMethodSupp": "",
				// "ZautocalTax": "",
				// "ZtotalTaxAmt": "",
				ZtaxJursidiction: invoiceItem.taxJurisdiction,
				// "ZbaselineDate": "",
				// "ZdueOn": "",
				// "ZvatAmount": "",
				// "ZvatAmount1": "",
				// "ZvatAmount2": "",
				// "ZvatAmount3": "",
				// "ZvatAmount4": "",
				// "ZvatRate": "",
				// "ZvatRate1": "",
				// "ZvatRate2": "",
				// "ZvatRate3": "",
				// "ZvatRate4": "",
				ZautocalTax : invoiceItem.autoCalculateTaxIndicator,
				Zitemtax : invoiceItem.itemTax,
				ZsupplierName : invoiceItem.supplierName,
				ZinvFreightAmt : invoiceItem.invoiceFreightAmount,
				ZsupplierName2 : invoiceItem.supplierName2,
                Zreminame : invoiceItem.remitName,
                Zremittoaddr1 : invoiceItem.remitToAddress1,
                Zremittoaddr2 : invoiceItem.remitToAddress2,
                Zremittostreet : invoiceItem.remitToStreet,
                Zremittopin : invoiceItem.remitToPin,
                Zremittovat : invoiceItem.remitToVAT,
				Zbilltocompany : invoiceItem.billToCompany,
				Zbilltoaddr1 : invoiceItem.billToAddress1,
                Zbilltoaddr2 : invoiceItem.billToAddress2,
                Zbilltocountry : invoiceItem.billToCountry,
                ZsupplierStreet : invoiceItem.supplierStreet,
                ZsupplierPoBoxZip : invoiceItem.supplierPOBoxZip,
				Zbilltoemail : invoiceItem.billToEmail,
				 ZpaymentTerm : invoiceItem.paymentTerms,
				 ZglAccount : invoiceItem.glAccount,
				 ZglDescription : invoiceItem.glDescription,
				 ZcostCenter : invoiceItem.costCenter,
				 Zwbs : invoiceItem.wbsElement,
				 ZinternalOrder : invoiceItem.internalOrder,
				 ZnetAmount: invoiceItem.netAmount,
				// "Zday1": "",
				// "Zday2": "",
				// "Zday3": "",
				// "Zdisc1": "",
				// "Zdisc2": "",
				// "ZexchangeRate": "",
				// "Zwht": "",
				// "ZunplannedDeliveryCost": "",
				// "ZinstKey": "",
				ZbankAcc: invoiceItem.bankAccount,
				ZbankName: invoiceItem.bankName,
				ZbankNo: invoiceItem.bankNumber,
				ZbankPartnerType:invoiceItem.bankPartnerType,
				// "ZvatId": "",
				// "ZvatId1": "",
				// "ZvatId2": "",
				// "ZvatId3": "",
				// "ZvatId4": "",
				// "ZreqEmil": "",
				// "ZinvFreightAmt": "",
				// "ZinvHandlingCharges": "",
				// "ZalternatePayee": "",
				ZdocItmInInvDoc : invoiceItem.documentItemInInvoice,
				ZpoNo : invoiceItem.purchaseOrder,
				ZitemnoPurchingDoc : invoiceItem.itemPurchaseOrder,
				ZpoUnitOfMeasure : invoiceItem.uomPurchaseOrder,
				ZamtDocCurr : invoiceItem.amountDocumentCurrency,
				ZitemDesc : invoiceItem.itemDescription,
				ZunitPrice : invoiceItem.unitPrice,
				ZdeliveryNote : invoiceItem.deliveryNoteNumber,
				// "ZitemTaxAmt": "",
				// "ZitemTaxRate": "",
				ZmaterialNo : invoiceItem.materialNumber,
				// "ZtaxCode": "",
				// "ZaccAssignBasedInv": "",
				ZdirectPostGl : invoiceItem.directPostingGL,
				ZdirectPostMaterial : invoiceItem.directPostingMaterial,
				// "Zstatus": "",
				// "ZtimeStamp": "",
				// "ZlastUser": "",
				// "ZcurrentUser": "",
				// "ZlastUpdatedTimeStamp": "",
				// "ZlastRole": "",
				// "ZinvoiceCategory": "",
				// "Zshiptoaddress1": "",
				// "Zshiptoaddress2": "",
				// "Zbilltocompany": "",
				// "Zbilltoname": "",
				// "Zbilltophone": "",
				// "Zbilltoaddr1": "",
				// "Zbilltoaddr2": "",
				// "Zbilltocountry": "",
				// "Zbilltovat": "",
				// "Zbilltoemail": "",
				// "Zreminame": "",
				// "Zremittoaddr1": "",
				// "Zremittoaddr2": "",
				// "Zremittopin": "",
				// "Zremittostreet": "",
				// "Zremittovat": "",
				// "ZremitToEmail": "",
				// "ZremitToPhone": "1234567890",
				// "ZsupplierNumber": "",
				// "ZsupplierName": "",
				// "ZsupplierName2": "",
				// "ZsupplierPoBox": "",
				// "ZsupplierPoBoxZip": "",
				// "ZsupplierStreet": "",
				// "ZsupplierState": "",
				// "ZsupplierZip": "",
				// "ZnetAmount": "",
				// "Zterms": "",
				// "Zrate": "",
				// "Ziban": "",
				// "Zswift": "",
				ZgrossAmount : invoiceItem.grossAmount,
				ZtotalTaxAmt : invoiceItem.totalTaxAmount,
				Zitemno : invoiceItem.itemNumber,
				Zitemprice : invoiceItem.itemPrice,
				Zitemqty : invoiceItem.itemQuantity,
				Zitemunit : invoiceItem.itemUnit,
				Zitemqtyship : invoiceItem.itemQuantityShipped,
				Ztotalamount : invoiceItem.totalAmount,
				Zpgidate : invoiceItem.pgiDate,
				ZitemCode : invoiceItem.itemCode,
				ZdeliveryNoteNumber : invoiceItem.deliveryNoteNumber
				// "ZcurrentRole": "",
				// "ZcompanyCodeLineItm": "",
				// "ZglAccount": "",
				// "ZglDescription": "",
				// "ZcostCenter": "",
				// "ZcostCenterDescription": "",
				// "Zwbs": "",
				// "ZwbsDescription": "",
				// "ZinternalOrder": "",
				// "ZinternalOrderDescription": "",
				// "Zasset": "",
				// "ZassetDescription": "",
				// "Zfilename": "",
				// "ZpostedInvoice": ""
		};

		gwInvoiceItems.push(gwInvoiceItem);
	}

	return gwInvoiceItems;

}

function generateGWInvoiceValidationPayload(invoiceItems) {

	var gwInvoiceItems = convertItemsToGWServicePayload(invoiceItems);

	var requestPayload = {
			d : {
				ZimageFingerprint : "",
				Finger_to_Processed : gwInvoiceItems,
				Finger_to_Exceptions : []
			}
	};

	return requestPayload;
}

function validateInvoice(invoiceItems) {
	try {
		
		var httpClient = new $.net.http.Client();

		var gwInvoiceValidation = $.net.http.readDestination(
				"coms.deloitte.apps.invoiceprocessor.services.saveInvoice",
		"GW_InvoiceValidation");

		var request = new $.net.http.Request($.net.http.POST, "");

		request.headers.set("X-Requested-With", "X");
		request.headers.set("Content-Type", "application/json");
		request.headers.set("Accept", "application/json");
		request.headers.set("SAP-Connectivity-SCC-Location_ID", "SCPINVST");
		request.headers.set("X-CSRF-Token", "CSRF");

		var requestPayload = generateGWInvoiceValidationPayload(invoiceItems);
		request.setBody(JSON.stringify(requestPayload));

		httpClient.request(request, gwInvoiceValidation);

		return httpClient.getResponse().body.asString();
	//	return output;
		

	} catch (exception) {
		throw exception;
	}
}

function convertGWResponseToItems(gwInvoiceItems){

	var i, gwInvoiceItem, invoiceItems = [];

	for(i = 0; i < gwInvoiceItems.length; i++){

		gwInvoiceItem = gwInvoiceItems[i];

		// Push a JS object into the array containing only the derived fields
		// along with the keys,moving data from zfields after derivation to hana table fiels
		invoiceItems.push({
			invoiceGUID: gwInvoiceItem.ZimageFingerprint,
			invoiceID: gwInvoiceItem.Zinvno,
			invoiceItemIndex: gwInvoiceItem.Zitemindex,
			invoiceDate: gwInvoiceItem.invoiceDate,
			invoiceStatus: "In_Process",
			documentType: gwInvoiceItem.ZdocType,
			documentDate: gwInvoiceItem.ZdocDate,
			postingDate: gwInvoiceItem.ZpostingDate,
			invoicingParty: gwInvoiceItem.ZinvoicingParty,
			companyCode: gwInvoiceItem.ZcompanyCode,
			invoiceType: gwInvoiceItem.ZinvType,
			supplierNumber: gwInvoiceItem.ZvendorNo,
			paymentMethod: gwInvoiceItem.ZpaymentMethod,
			paymentBlock: gwInvoiceItem.ZpaymentBlock,
			partnerBank: gwInvoiceItem.ZpartnerBank,
			houseBank: gwInvoiceItem.ZhouseBank,
			houseBankAccountID: gwInvoiceItem.ZhouseBankAccid,
			paymentMethodSupp: gwInvoiceItem.ZpaymentMethodSupp,
			autoCalculateTaxIndicator: gwInvoiceItem.ZautocalTax,
			taxJurisdiction: gwInvoiceItem.ZtaxJursidiction,
			baselineDate: gwInvoiceItem.ZbaselineDate,
			dueDate: gwInvoiceItem.ZdueOn,
			itemTax : gwInvoiceItem.Zitemtax,
			supplierName: gwInvoiceItem.ZsupplierName,
			invoiceFreightAmount:gwInvoiceItem.ZinvFreightAmt,
            paymentCurrency:gwInvoiceItem.Zcurrency,
            totalTaxAmount: gwInvoiceItem.ZtotalTaxAmt,
			billToEmail: gwInvoiceItem.Zbilltoemail,
			supplierName2: gwInvoiceItem.ZsupplierName2,
            remitName: gwInvoiceItem.Zreminame,
            remitToAddress1: gwInvoiceItem.Zremittoaddr1,
            remitToAddress2: gwInvoiceItem.Zremittoaddr2,
            remitToStreet: gwInvoiceItem.Zremittostreet,
            remitToPin: gwInvoiceItem.Zremittopin,
            remitToVAT: gwInvoiceItem.Zremittovat,
			billToCompany:gwInvoiceItem.Zbilltocompany,
			billToAddress1:gwInvoiceItem.Zbilltoaddr1,
            billToAddress2:gwInvoiceItem.Zbilltoaddr2,
            billToCountry:gwInvoiceItem.Zbilltocountry,
            supplierStreet:gwInvoiceItem.ZsupplierStreet,
            supplierPOBoxZip:gwInvoiceItem.ZsupplierPoBoxZip,
			paymentTerms:gwInvoiceItem.ZpaymentTerm,
			day1: gwInvoiceItem.Zday1,
			day2: gwInvoiceItem.Zday2,
			day3: gwInvoiceItem.Zday3,
			discount1: gwInvoiceItem.Zdisc1,
			discount2: gwInvoiceItem.Zdisc2,
			exchangeRate: gwInvoiceItem.ZexchangeRate,
			withholdingTax: gwInvoiceItem.Zwht,
			unplannedDeliveryCost: gwInvoiceItem.ZunplannedDeliveryCost,
			instanceKey: gwInvoiceItem.ZinstKey,
			// Hasan code started
			bankName: gwInvoiceItem.ZbankName,
			bankAccount: gwInvoiceItem.ZbankAcc,
			bankNumber: gwInvoiceItem.ZbankNo,
			// Hasan code ended
			bankPartnerType: gwInvoiceItem.ZbankPartnerType,
			alternatePayee: gwInvoiceItem.ZalternatePayee,
			itemNumber: gwInvoiceItem.Zitemno,
			itemUnit: gwInvoiceItem.Zitemunit,
			materialNumber: gwInvoiceItem.ZmaterialNo,
			taxCode: gwInvoiceItem.ZtaxCode,
			accountAssigned: gwInvoiceItem.ZaccAssignBasedInv,
			directPostingMaterial: gwInvoiceItem.ZdirectPostMaterial,
			lastUser: gwInvoiceItem.ZlastUser,
			currentUser: gwInvoiceItem.ZcurrentUser,
			lastUpdatedTS: gwInvoiceItem.ZlastUpdatedTimeStamp,
			lastRole: gwInvoiceItem.ZlastRole,
			itemCode: gwInvoiceItem.ZitemCode,
			 glAccount : gwInvoiceItem.ZglAccount,
			glDescription : gwInvoiceItem.ZglDescription,
			costCenter : gwInvoiceItem.ZcostCenter,
			wbs : gwInvoiceItem.ZwbsElement,
			internalOrder : gwInvoiceItem.ZinternalOrder,
			netAmount: gwInvoiceItem.ZnetAmount,
			itemCompanyCode: gwInvoiceItem.ZcompanyCodeLineItm
		});
	}

	return invoiceItems;
}

function convertGWResponseToExceptions(gwExceptions){

	var i, gwException, invoiceExceptions = [];

	for(i = 0; i < gwExceptions.length; i++){
		gwException = gwExceptions[i];

		invoiceExceptions.push({
			invoiceGUID: gwException.ZimageFingerprint,
			exceptionIndex: String(i),
			exceptionMessage: gwException.ZexceptionNo
		});
	}

	return invoiceExceptions;

}

function parseGWServiceResponse(gwServiceResponse){

	var invoiceItems, invoiceExceptions;
	
//	throw new Error(JSON.stringify(gwServiceResponse));
	var gwServiceResponseJSON = JSON.parse(gwServiceResponse);

	if(gwServiceResponseJSON.d.Finger_to_Processed){
		invoiceItems = convertGWResponseToItems(gwServiceResponseJSON.d.Finger_to_Processed.results);
	}
	
	if(gwServiceResponseJSON.d.Finger_to_Exceptions){
		invoiceExceptions =
			convertGWResponseToExceptions(gwServiceResponseJSON.d.Finger_to_Exceptions.results);
					
	}

	var parsedGWResponse = {
			updatedInvoiceItems: invoiceItems,
			exceptions:  invoiceExceptions
	};

	return parsedGWResponse;
}

function saveInvoice(request) {
	var invoiceController = $.import('../libs/invoice-controller.xsjslib');
 
	try {
		var invoiceExceptions;
		
		$.response.status = $.net.http.OK;
		$.response.contentType = "application/json";
	//	var processedInvoiceJSON = JSON.parse(request.body.asString());
		var processedInvoiceJSON = input;
		var updatedInvoiceItems =
			invoiceController.updateInvoice(processedInvoiceJSON.invoiceItems, false);

		var gwServiceResponse = validateInvoice(updatedInvoiceItems);
        
		var parsedGWResponse = parseGWServiceResponse(gwServiceResponse);

		// Before updating the derived fields and exceptions, delete all the
		// current exception entries existing for the invoice, as validations
		// have been re-triggered
		invoiceController.clearExceptions(parsedGWResponse.updatedInvoiceItems[0].invoiceGUID);
		
		if(parsedGWResponse.updatedInvoiceItems){
			updatedInvoiceItems =
				invoiceController.updateInvoice(parsedGWResponse.updatedInvoiceItems, true);
		}
		
		if(parsedGWResponse.exceptions){
			invoiceExceptions =
				invoiceController.updateExceptions(parsedGWResponse.exceptions);
		}
		

		var response = {
				updatedInvoiceItems: updatedInvoiceItems,
				exceptions: invoiceExceptions.exceptions,
				exceptionWorkflowItems:invoiceExceptions.exceptionWorkflowItems
		};

		$.response.setBody(JSON.stringify(response));

	} catch (exception) {
		throw exception;
	}
}

function main() {
	
	try {

		switch ($.request.method) {
			//case $.net.http.POST :
			//	saveInvoice($.request);
			//	break;
				 case $.net.http.GET :
				saveInvoice($.request);
				 break;
			default :
				$.response.status = $.net.http.METHOD_NOT_ALLOWED;
			$.response.setBody("Method not Allowed: " + $.request.method);
		}

	} catch (exception) {
		$.response.status = $.net.http.OK;
		$.response.setBody(JSON.stringify(exception.message.toString()));
	}
}

main();
